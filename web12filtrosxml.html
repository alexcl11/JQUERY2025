<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web 12 Filtros XML</title>
</head>
<body>
    <h1>Filtros en XML</h1>
    <hr>
    <label>Introduzca ID: </label>
    <input type="text" id="cajaid">
    <button id="botonatributo">Buscar atributo ID</button>
    <hr>
    <label>Introduzca LOCALIDAD: </label>
    <input type="text" id="cajalocalidad">
    <button id="botonlocalidad">Buscar localidad</button>
    <hr>
    <h1 id="outputid"></h1>
    <ul id="listadepartamentos"></ul>

    <script src="js/jquery-3.7.1.js"></script>
    <script>
        $(document).ready(function(){
            $("#botonatributo").click(function(){
                var numerodepartamento = parseInt($("#cajaid").val())
                $.get("documents/departamentos.xml", function(data){
                    var nododept = $(data).find("DEPT[DEPT_NO="+numerodepartamento+"]").first()
                    var id = $(nododept).attr("DEPT_NO")
                    var nombre = $(nododept).find("DNOMBRE") .text()
                    var localidad = $(nododept).find("LOC") .text()
                    $("#outputid").text("ID: "+id+" || Nombre: "+nombre+" || Localidad: "+localidad)                    
                })
            })
            $("#botonlocalidad").click(function(){
                $("#listadepartamentos").html("")
                var localidad = $("#cajalocalidad").val()
                $.get("documents/departamentos.xml", function(data){
                    //FORMA DEL PROFE
                    var filtro = "LOC:contains("+localidad+")"
                    $(data).find(filtro).each(function(){
                        var id = $(this).parent().attr("DEPT_NO")
                        var nombre = $(this).parent().find("DNOMBRE").text()
                        var lilocalidad = $("<li>", {"text":"ID: "+id+" || Nombre: "+nombre+" || Localidad: " +localidad})
                        $("#listadepartamentos").append(lilocalidad)                       
                    })


                    //MI FORMA
                    // $(data).find("DEPT").each(function(){
                    //     var localidadxml = $(this).find("LOC").text()
                    //     if(localidad == localidadxml){
                    //         var id = $(this).attr("DEPT_NO")
                    //         var nombre = $(this).find("DNOMBRE").text()
                    //         var lilocalidad = $("<li>", {"text":"ID: "+id+" || Nombre: "+nombre+" || Localidad: " +localidad})
                    //         $("#listadepartamentos").append(lilocalidad)
                    //     }
                    // })
                })
                console.log($("#listadepartamentos").children().length == 0)
                if($("#listadepartamentos").has("<li>")){
                    $("#listadepartamentos").html("<li>No se han encontrado localidades con ese nombre</li>") 
                }
            })
        })
    </script>
</body>
</html>